<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Workflow Configuration</title>
    <style>
        html {
            font-size: 16px;
        }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 1.25rem;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 50rem;
            margin: 0 auto;
            background-color: white;
            padding: 1.25rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.1);
        }
        h1 {
            margin-top: 0;
            color: #333;
            font-size: 2rem;
        }
        .form-group {
            margin-bottom: 0.9375rem;
        }
        label {
            display: block;
            margin-bottom: 0.3125rem;
            font-weight: bold;
        }
        input[type="text"], select, textarea {
            width: 100%;
            padding: 0.5em;
            border: 1px solid #ddd;
            border-radius: 0.25em;
            box-sizing: border-box;
            font-size: 1em;
        }
        .input-box {
            margin-top: 0.625rem;
            padding: 0.625rem;
            display: none;
            background-color: #e9f7fe;
            border-radius: 0.3125rem;
        }
        .steps-container {
            margin-top: 1.875rem;
            padding: 0.9375rem;
            border: 1px solid #ddd;
            border-radius: 0.3125rem;
            background-color: #f0f0f0;
            display: none;
        }
        .step {
            margin-bottom: 0.9375rem;
            padding: 0.625rem;
            background-color: white;
            border-radius: 0.25rem;
            border-left: 0.25rem solid #4CAF50;
            position: relative;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 0.625rem 0.9375rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 0.625rem;
        }
        button:hover {
            background-color: #45a049;
        }
        button.update {
            background-color: #888;
        }
        button.update:hover {
            background-color: #777;
        }
        button.download {
            background-color: #007bff;
            font-size: 0.75rem;
            margin: 0;
            padding: 0.25rem;
            vertical-align: center;
        }
        button.download:hover {
            background-color: #0056b3;
        }
        code {
            display: block;
            padding: 0.625rem;
            background-color: #f1f1f1;
            border-radius: 0.25rem;
            white-space: pre-wrap;
            font-family: monospace;
            margin-top: 0.3125rem;
            font-size: 0.95em;
        }
        .checkbox-container {
            padding: 0.625rem;
            border: 1px solid #eee;
            border-radius: 0.3125rem;
            margin-bottom: 0.625rem;
            background-color: #f9f9f9;
        }
        a {
            text-decoration: none;
        }
        .tooltip-btn {
            display: inline-block;
            width: 1em;
            height: 1em;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 1em;
            font-size: 0.75em;
            margin-left: 0.3125em;
            cursor: pointer;
            position: relative;
        }
        .tooltip-content {
            visibility: hidden;
            width: 12.5rem;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 0.375rem;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            top: -0.3125rem;
            left: 125%;
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-size: 0.75em;
        }
        .tooltip-btn:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        .copy-btn {
            position: absolute;
            right: 0.625rem;
            top: 0.625rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            margin: 0;
        }
        .copy-btn:hover {
            background-color: #0056b3;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        .tab button {
            background-color: #45a049;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 0.625rem 0.9375rem;
            transition: background-color 0.3s, transform 0.2s;
            font-size: 0.875rem;
            width: 25%;
        }
        .tab button:hover {
            background-color: #33d859;
            transform: scale(1.05);
        }
        .tab button.active {
            background-color: #33d859;
        }
        .tabcontent {
            display: none;
            padding: 0.375rem 0.75rem;
            border: 1px solid #ccc;
            border-top: none;
        }
        .troubleshoot-panel {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            height: 100vh;
        }
        .troubleshoot-btn {
            background-color: #888;
            color: white;
            padding: 0;
            left: 0;
            top: 0.625rem;
            border: none;
            border-radius: 0.25rem;
            width: 1.5625rem;
            height: 1.5625rem;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        .close-troubleshoot {
            position: fixed;
            left: 0;
            top: 0;
            background-color: rgba(136, 136, 136, 0.4);
            color: white;
            border: none;
            border-radius: 0.25rem;
            width: 1.5625rem;
            height: 1.5625rem;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        .troubleshoot-content {
            position: fixed;
            left: 0;
            top: 0;
            width: 16vw;
            min-width: 12rem;
            max-width: 20vw;
            height: 100vh;
            background-color: white;
            box-shadow: 0.125rem 0 0.3125rem rgba(0,0,0,0.1);
            padding: 0.625rem;
            display: none;
            overflow-y: auto;
        }
        .troubleshoot-content.open {
            display: block;
        }
        .troubleshoot-content h4 {
            font-size: 1rem;
            margin-top: 0.625rem;
            margin-bottom: 0.9375rem;
        }
        .version-text {
            position: fixed;
            left: 0.625rem;
            bottom: 0.625rem;
            font-size: 0.9375rem;
            margin: 0;
            z-index: 1001;
        }
        .build-tracking {
            color: #28a745;
            font-weight: bold;
            padding: 0.125rem 0.3125rem;
            border-radius: 0.1875rem;
        }
        .build-tracking:hover {
            background-color: #2bee58;
            color: white;
            text-decoration: none;
        }
        .reset {
            position: fixed;
            right: 0.625rem;
            bottom: 0.625rem;
            font-size: 0.75rem;
            background-color: #888;
            border-radius: 50%;
            z-index: 1001;
            margin: 0;
            width: 2.2rem;
            height: 2.2rem;
        }
        .checkbox-label {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        .checkbox-label:hover .checkbox-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .checkbox-tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: beige;
            color: black;
            text-align: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.2);
            font-size: 0.75em;
            min-width: 12.5rem;
            max-width: 18.75rem;
        }
        .session-sidebar {
            position: fixed;
            top: 3.75rem;
            right: 0;
            width: 17vw;
            min-width: 12rem;
            max-width: 22vw;
            height: auto;
            background: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,0.13);
            z-index: 1200;
            font-size: 0.75rem;
            border-radius: 0.625rem;
            margin-top: 0;
            padding: 0;
            overflow: visible;
        }
        .session-sidebar .widget-content {
            display: block;
            width: 100%;
            min-height: 7.5rem;
            max-height: 60vh;
            height: 50vh;
            overflow-y: auto;
            background: #fff;
            border-radius: 0.625rem;
            box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,0.13);
            position: static;
            padding: 0.625rem 0.125rem 0.375rem 0.375rem;
            box-sizing: border-box;
        }
        .session-sidebar h3 {
            margin-top: 0;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .session-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.6875rem;
            table-layout: fixed;
        }
        .session-table th, .session-table td {
            border-bottom: 1px solid #eee;
            padding: 0.1875rem 0.125rem;
            text-align: left;
            overflow-wrap: anywhere;
            word-break: break-word;
            white-space: normal;
        }
        .session-table th {
            background: #f5f5f5;
            font-size: 0.6875rem;
        }
        .session-table th:nth-child(1),
        .session-table td:nth-child(1) {
            width: 40%;
        }
        .session-table th:nth-child(2),
        .session-table td:nth-child(2) {
            width: 40%;
        }
        .session-table th:nth-child(3),
        .session-table td:nth-child(3) {
            width: 20%;
        }
        .session-table, .session-table thead, .session-table tbody, .session-table tr, .session-table th, .session-table td {
            box-sizing: border-box;
        }
        .session-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
            background: none;
            border: none;
            padding: 0;
            font-size: 0.6875rem;
            word-break: break-all;
        }
        .session-delete-btn {
            background: #f44336;
            color: #fff;
            border: none;
            border-radius: 0.25rem;
            padding: 0.0625rem 0.3125rem;
            font-size: 0.625rem;
            cursor: pointer;
        }
        .save-session-btn {
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.625rem;
            font-size: 0.75rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
            float: right;
        }
        .save-session-btn:hover {
            background: #0056b3;
        }

        /* Responsive Styles */
        @media (max-width: 1100px) {
            .session-sidebar {
                display: none;
            }
            .container {
                max-width: 95vw;
                padding: 1rem;
            }
        }
        @media (max-width: 900px) {
            html {
                font-size: 15px;
            }
            .container {
                max-width: 98vw;
                padding: 0.75rem;
            }
            .troubleshoot-content {
                width: 30vw;
                min-width: 10rem;
                max-width: 40vw;
            }
        }
        @media (max-width: 700px) {
            html {
                font-size: 14px;
            }
            .container {
                max-width: 100vw;
                padding: 0.5rem;
            }
            .troubleshoot-content {
                width: 60vw;
                min-width: 8rem;
                max-width: 80vw;
            }
            .tab button {
                width: 33.33%;
                font-size: 0.9rem;
                padding: 0.5rem 0.5rem;
            }
        }
        @media (max-width: 500px) {
            html {
                font-size: 13px;
            }
            .container {
                max-width: 100vw;
                padding: 0.25rem;
            }
            .troubleshoot-content {
                width: 90vw;
                min-width: 6rem;
                max-width: 100vw;
                padding: 0.25rem;
            }
            .tab button {
                width: 100%;
                font-size: 1rem;
                padding: 0.5rem 0.25rem;
            }
            .reset, .version-text {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>    
    <!-- Add this before the main container -->
    <div class="troubleshoot-panel">
        <button class="troubleshoot-btn" onclick="toggleTroubleshoot()">≡</button>
        <div class="troubleshoot-content" id="troubleshootPanel">
            <button class="close-troubleshoot" onclick="toggleTroubleshoot()">›</button>
            <br></br>
            <h4>Troubleshooting Guide</h4>
                <p>Failed to run Brazil<br>
                Likely to see at step 1. Solution: </p>
                <code>toolbox install brazilcli</code>
                <p>Failed to run Brazil after install Brazil<br>
                Solution: run command below replace xxxxx with any number between 40000-60000</p>
                <code>brazil prefs --key packagecache.port --value xxxxx --global</code>
                <p>If you get  java runtime error fault when running brazil-build<br>Solution:</p>
                <code>who -u
sudo kill &lt;PID get it from who command&gt;</code>
                <p>How to drop a CR in any package<br>
                Get &lt;CR hash&gt; at<code>code.amazon.com</code>
                Then do<code>git rebase -i &lt;CR hash&gt;</code>
                Press i key. Then replace "pick" with "drop" with the CR you want to drop. Escape when done with edit. Save & quit:<code>:wq</code></p>
                <p>Auto custom builder tool section: 
                <button id="downloadBtn" class="download" onclick="downloadConfig()" style="display: none; vertical-align: center;">⭳</button></p>
                <p>Run command to open auto builder tool
                <code>autobuild</code></p>
                             
        </div>
    </div>
    
    <div class="container">
        <h1>WorkSpace & Workflow Builder</h1>
        <div id="configForm">
            <!-- General Inputs -->
            <div class="form-group">
                <label for="testDate">Test Date (YYYYMMDD):</label>
                <input type="text" id="testDate" placeholder="For QA enter workflow" oninput="updateWorkspaceTitle()">
            </div>
            <div class="form-group">
                <label for="testTitle">Test Title (alias):</label>
                <input type="text" id="testTitle" placeholder="For QA enter build number-custom" oninput="updateWorkspaceTitle()">
            </div>
            <div class="form-group">
                <label for="workspaceTitle">Workspace/Workflow Title:</label>
                <input type="text" id="workspaceTitle" placeholder="Workspace/Workflow title" readonly>
            </div>

            <!-- Subsystem Checkbox -->
            <div class="checkbox-container" style="display: flex; gap: 20px;">
                <label><input type="checkbox" id="stowCheckbox" onchange="toggleSection('stowSection')"> Stow</label>
                <label><input type="checkbox" id="bufferCheckbox" onchange="toggleSection('bufferSection')"> Buffer</label>
                <label><input type="checkbox" id="transferCheckbox" onchange="toggleSection('transferSection')"> Transfer</label>
            </div>

            <!-- Sections -->
            <div id="stowSection" style="display: none; margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                <h3>Stow Section</h3>
                <div class="form-group">
                    <label for="stowWorkcellId">Workcell ID:</label>
                    <select id="stowWorkcellId">
                        <option value="">Select Workcell ID</option>
                        <option value="0203">α 2 1:1 0203</option>
                        <option value="0206">α 2 1:3 0206</option>
                        <option value="0207">α 2 1:3 0207</option>
                        <option value="0208">α 2 1:3 0208</option>
                        <option value="0303">β   1:1 0303</option>
                        <option value="0306">β   1:3 0306</option>
                        <option value="0307">β   1:3 0307</option>
                        <option value="0308">β   1:3 0308</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stowEventId">Event ID: <a id="eventIdLink" class="build-tracking" href="#" target="tracking">Build Tracking</a></label>
                    <input type="text" id="stowEventId" placeholder="Event ID">
                </div>
                <div class="checkbox-container">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="stowMainline" onchange="toggleMainline()">
                            <span>Mainline</span>
                            <span class="checkbox-tooltip">Select this box if engineer tell you to build mainline</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="stowImageTag" onchange="toggleInput('stowImageTagInput')">
                            <span>Image Tag</span>
                            <span class="checkbox-tooltip">Select if you have any image tag need to swap</span>
                        </label>
                        <div id="stowImageTagInput" class="input-box">
                            <label for="stowImageTagValue">Enter Image Tag:</label>
                            <textarea id="stowImageTagValue" placeholder="Enter image tag"></textarea>
                        </div>
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="stowCherryPick" onchange="toggleCherryPickSection('stowCherryPickSection', 'stowAddBtn')">
                            <span>Cherry Pick Packages</span>
                            <span class="checkbox-tooltip">Select if you have any CR cherry pick</span>
                        </label>
                        <button id="stowAddBtn" style="display: none; background-color: #4CAF50; color: white; border: none; border-radius: 6px; padding: 0 10px; margin-top: 0px; margin-bottom: 5px; height: 24px; font-size: 12px; text-align: center; cursor: pointer;">Add Package</button>
                    </div>
                    <div id="stowCherryPickSection" style="display: none; margin-top: 10px;">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="stowVsConfigPick" onchange="toggleInput('stowVsConfigPickInput')">
                                <span>Vulcan Stow Config</span>
                                <span class="checkbox-tooltip">Select if you have Vulcan Stow Config package CR</span>
                            </label>
                            <div id="stowVsConfigPickInput" class="input-box">
                                <label for="stowVsConfigPickValue">Enter Vulcan Config cherry pick value:</label>
                                <textarea id="stowVsConfigPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="stowDeployArtifactsPick" onchange="toggleInput('stowDeployArtifactsPickInput')">
                                <span>Deployment Artifacts</span>
                                <span class="checkbox-tooltip">Select if you have Deployment Artifacts package CR</span>
                            </label>
                            <div id="stowDeployArtifactsPickInput" class="input-box">
                                <label for="stowDeployArtifactsPickValue">Enter Deploy Artifacts cherry pick value:</label>
                                <textarea id="stowDeployArtifactsPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div id="stowDynamicInputs"></div>
                    </div>
                </div>
            </div>

            <div id="bufferSection" style="display: none; margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                <h3>Buffer Section</h3>
                <div class="form-group">
                    <label for="bufferWorkcellId">Workcell ID:</label>
                    <select id="bufferWorkcellId">
                        <option value="">Select Workcell ID</option>
                        <option value="0203">α 2 1:1 0203</option>
                        <option value="0206">α 2 1:3 0206</option>
                        <option value="0207">α 2 1:3 0207</option>
                        <option value="0208">α 2 1:3 0208</option>
                        <option value="0303">β   1:1 0303</option>
                        <option value="0306">β   1:3 0306</option>
                        <option value="0307">β   1:3 0307</option>
                        <option value="0308">β   1:3 0308</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bufferEventId">Event ID: <a id="eventIdLink" class="build-tracking" href="#" target="tracking">Build Tracking</a></label>
                    <input type="text" id="bufferEventId" placeholder="Event ID">
                </div>
                <div class="checkbox-container">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bufferMainline" onchange="toggleMainline()">
                            <span>Mainline</span>
                            <span class="checkbox-tooltip">Select this box if engineer tell you to build mainline</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="bufferImageTag" onchange="toggleInput('bufferImageTagInput')">
                            <span>Image Tag</span>
                            <span class="checkbox-tooltip">Select if you have any image tag need to swap</span>
                        </label>
                        <div id="bufferImageTagInput" class="input-box">
                            <label for="bufferImageTagValue">Enter Image Tag:</label>
                            <textarea id="bufferImageTagValue" placeholder="Enter image tag"></textarea>
                        </div>
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="bufferCherryPick" onchange="toggleCherryPickSection('bufferCherryPickSection', 'bufferAddBtn')">
                            <span>Cherry Pick Packages</span>
                            <span class="checkbox-tooltip">Select if you have any CR cherry pick</span>
                        </label>
                        <button id="bufferAddBtn" style="display: none; background-color: #4CAF50; color: white; border: none; border-radius: 6px; padding: 2px 10px; font-size: 12px; text-align: center; cursor: pointer;">Add Package</button>
                    </div>
                    <div id="bufferCherryPickSection" style="display: none; margin-top: 10px;">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="bufferVsConfigPick" onchange="toggleInput('bufferVsConfigPickInput')">
                                <span>Vulcan Config</span>
                                <span class="checkbox-tooltip">Select if you have Vulcan Stow Config package CR</span>
                            </label>
                            <div id="bufferVsConfigPickInput" class="input-box">
                                <label for="bufferVsConfigPickValue">Enter Vulcan Config cherry pick value:</label>
                                <textarea id="bufferVsConfigPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="bufferDeployArtifactsPick" onchange="toggleInput('bufferDeployArtifactsPickInput')">
                                <span>Deploy Artifacts</span>
                                <span class="checkbox-tooltip">Select if you have Deployment Artifacts package CR</span>
                            </label>
                            <div id="bufferDeployArtifactsPickInput" class="input-box">
                                <label for="bufferDeployArtifactsPickValue">Enter Deploy Artifacts cherry pick value:</label>
                                <textarea id="bufferDeployArtifactsPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div id="bufferDynamicInputs"></div>
                    </div>
                </div>
            </div>

            <div id="transferSection" style="display: none; margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                <h3>Transfer Section</h3>
                <div class="form-group">
                    <label for="transferWorkcellId">Workcell ID:</label>
                    <select id="transferWorkcellId">
                        <option value="">Select Workcell ID</option>
                        <option value="0202">α 2 1:1 0202</option>
                        <option value="0205">α 2 1:3 0205</option>
                        <option value="0302">β   1:1 0302</option>
                        <option value="0305">β   1:3 0305</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transferEventId">Event ID: <a id="eventIdLink" class="build-tracking" href="#" target="tracking">Build Tracking</a></label>
                    <input type="text" id="transferEventId" placeholder="Event ID">
                </div>
                <div class="checkbox-container">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="transferMainline" onchange="toggleMainline()">
                            <span>Mainline</span>
                            <span class="checkbox-tooltip">Select this box if engineer tell you to build mainline</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="transferImageTag" onchange="toggleInput('transferImageTagInput')">
                            <span>Image Tag</span>
                            <span class="checkbox-tooltip">Select if you have any image tag need to swap</span>
                        </label>
                        <div id="transferImageTagInput" class="input-box">
                            <label for="transferImageTagValue">Enter Image Tag:</label>
                            <textarea id="transferImageTagValue" placeholder="Enter image tag"></textarea>
                        </div>
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="transferCherryPick" onchange="toggleCherryPickSection('transferCherryPickSection', 'transferAddBtn')">
                            <span>Cherry Pick Packages</span>
                            <span class="checkbox-tooltip">Select if you have any CR cherry pick</span>
                        </label>
                        <button id="transferAddBtn" style="display: none; background-color: #4CAF50; color: white; border: none; border-radius: 6px; padding: 2px 10px; font-size: 12px; text-align: center; cursor: pointer;">Add Package</button>
                    </div>
                    <div id="transferCherryPickSection" style="display: none; margin-top: 10px;">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="transferVsConfigPick" onchange="toggleInput('transferVsConfigPickInput')">
                                <span>Vulcan Config</span>
                                <span class="checkbox-tooltip">Select if you have Vulcan Stow Config package CR</span>
                            </label>
                            <div id="transferVsConfigPickInput" class="input-box">
                                <label for="transferVsConfigPickValue">Enter Vulcan Config cherry pick value:</label>
                                <textarea id="transferVsConfigPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="transferDeployArtifactsPick" onchange="toggleInput('transferDeployArtifactsPickInput')">
                                <span>Deploy Artifacts</span>
                                <span class="checkbox-tooltip">Select if you have Deployment Artifacts package CR</span>
                            </label>
                            <div id="transferDeployArtifactsPickInput" class="input-box">
                                <label for="transferDeployArtifactsPickValue">Enter Deploy Artifacts cherry pick value:</label>
                                <textarea id="transferDeployArtifactsPickValue" placeholder=""></textarea>
                            </div>
                        </div>
                        <div id="transferDynamicInputs"></div>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div id="actionButtons">
                <button id="generateBtn" onclick="generateSteps()">Guide Me!</button>
                <button id="regenerateBtn" class="update" onclick="regenerate()" style="display: none;">Regenerate</button>
                <button id="downloadBtn" class="download" onclick="downloadConfig()" style="display: none;">⭳</button>
            </div>

            <!-- Steps Guide -->
            <div id="stepsGuide" class="steps-container" style="display: none;">
                <div class="tab">
                    <button class="tablinks" id="stowTabBtn" onclick="openTab(event, 'StowTab')" style="display: none;">Stow</button>
                    <button class="tablinks" id="bufferTabBtn" onclick="openTab(event, 'BufferTab')" style="display: none;">Buffer</button>
                    <button class="tablinks" id="transferTabBtn" onclick="openTab(event, 'TransferTab')" style="display: none;">Transfer</button>
                </div>
                <div id="StowTab" class="tabcontent"><h3>Stow Section</h3><div id="stowSteps"></div></div>
                <div id="BufferTab" class="tabcontent"><h3>Buffer Section</h3><div id="bufferSteps"></div></div>
                <div id="TransferTab" class="tabcontent"><h3>Transfer Section</h3><div id="transferSteps"></div></div>
            </div>
        </div>
    </div>

    <button id="resetBtn" class="reset" onclick="resetForm()">&#10227;</button>
    <p class="version-text" id="version"></p>
<!-- Version     -->
    <p class="version-text" id="version"></p>

    <!-- Session Table Sidebar Widget -->
    <div class="session-sidebar" id="sessionSidebar">
        <!-- Remove widget-toggle button -->
        <div class="widget-content" id="sessionWidgetContent">
            <h3>Saved Sessions</h3>
            <table class="session-table" id="sessionTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Timestamp</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="sessionTableBody">
                    <!-- Sessions will be populated here -->
                </tbody>
            </table>
            <button class="save-session-btn" id="saveSessionBtn" onclick="saveSession()" style="float:none;display:block;width:100%;margin:10px 0 0 0;">Save Session</button>
        </div>
    </div>

    <script>
        // Set the version text in the UI
        const ver = "v7.0";
        document.getElementById("version").innerHTML = ver;

        // Set build tracking links for Event ID fields
        document.addEventListener('DOMContentLoaded', function buildTracking () {    
            const eventIdUrl = 'https://amazon.enterprise.slack.com/lists/T016NEJQWE9/F0939EHTDHA?view_id=View09454SQB7W'
            const links = document.querySelectorAll('.build-tracking');
            links.forEach(link => {
                link.href = eventIdUrl;
                link.target = 'tracking';
            });
        });

        // Tooltip text for each step in the workflow
        const stepTooltips = {
            1: 'Creates a new workspace with the specified subsystem deployment artifacts at home directory. Then navigate to workspace directory to pull 2 basic packages (VulcanStowconfig & Deployment Artifacts).',
            2: 'Pull additional service packages if specified.',
            3: 'Navigate to VulcanStowConfig directory for cherry pick if specified.',
            4: 'Navigate to different service package directory to apply Cherry Pick CR if specified, otherwise just build the local environment for specified station then navigate to workspace directory.',
            5: 'Navigate to the deployment artifacts directory and apply cherry pick if specified.',
            6: 'Modify docker-compose.yaml for image tag if needed.',
            7: 'Build the workflow using Deployment Artifacts package.',
            8: 'Rsync builded artifacts to the target deployment workflow directory.',
            9: 'Navigate to the workflow directory.',
            10: 'Execute the launch script to start the workflow.'
        };

        function stepHeader(stepNum) {
            return `<strong>Step ${stepNum}:</strong>`;
        }
        function toolTips(stepNum) {
            return `<span class=\"tooltip-btn\">?<span class=\"tooltip-content\">${stepTooltips[stepNum]}</span></span>`;
        }

        // Step functions for modular step generation
        function step1(section, stepNum, workspace, eventId, mainlineValue) {
            let artifact = section === 'stow' ? 'VulcanReorientStowDeploymentArtifacts' : section === 'buffer' ? 'VulcanStowBufferDeploymentArtifacts' : 'VulcanInductTransferDeploymentArtifacts';
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(1)}
<code id=\"${section}Step${stepNum}\">cd
brazil ws create --versionset VulcanStowUnifiedDeploymentArtifacts/development --name workspace-${workspace} ${eventId}
cd workspace-${workspace}
brazil ws --use --platform AL2_x86_64
brazil setup platform-support --force
brazil ws --use -p VulcanStowConfig -p ${artifact} ${mainlineValue}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step2(section, stepNum, packageNames) {
            let step2Packages = packageNames.length > 0 
                ?'brazil ws --use ' + packageNames.map(pkg => `-p ${pkg}`).join(' ')
                : '';
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(2)}
<code id=\"${section}Step${stepNum}\">${step2Packages}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step3(section, stepNum, vsconfig) {
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(3)}
<code id=\"${section}Step${stepNum}\">cd src/VulcanStowConfig
${vsconfig}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step4(section, stepNum, packageNames, gitCommands, workcellId) {
            let step4Commands = packageNames.length > 0 
                ? packageNames.map((pkg, index) => `cd ../${pkg}\n${gitCommands[index]}\n`).join('\n') + `cd ../..\nbrazil-recursive-cmd --allPackages brazil-build`
                : `brazil-build local beta NAFulfillment Atlas Lab ${workcellId}\ncd ../..`;
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(4)}
<code id=\"${section}Step${stepNum}\">${step4Commands}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step5(section, stepNum, deployArtifacts) {
            let artifact = section === 'stow' ? 'VulcanReorientStowDeploymentArtifacts' : section === 'buffer' ? 'VulcanStowBufferDeploymentArtifacts' : 'VulcanInductTransferDeploymentArtifacts';
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(5)}
<code id=\"${section}Step${stepNum}\">cd src/${artifact}
${deployArtifacts}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step6(section, stepNum, imageTag) {
            let step6Command = `nano docker-compose.yaml\nTag image below:<br>\n${imageTag}`;
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(6)}
<code id=\"${section}Step${stepNum}\">${step6Command}</code>
</div>`
            };
        }
        function step7(section, stepNum) {
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(7)}
<code id=\"${section}Step${stepNum}\">brazil-build</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step8(section, stepNum, workspace) {
            let dir = section === 'stow' ? 'stow' : section === 'buffer' ? 'buffer' : 'induct_transfer';
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(8)}
<code id=\"${section}Step${stepNum}\">sudo rsync -avzh -O --no-perms --no-owner --no-group --delete --stats --copy-links --exclude /build/private ./build/ /opt/carbon/${dir}/workflow-${workspace}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step9(section, stepNum, workspace) {
            let dir = section === 'stow' ? 'stow' : section === 'buffer' ? 'buffer' : 'induct_transfer';
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(9)}
<code id=\"${section}Step${stepNum}\">cd /opt/carbon/${dir}/workflow-${workspace}</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }
        function step10(section, stepNum) {
            return {
                html: `<div class=\"step\">${stepHeader(stepNum)}${toolTips(10)}
<code id=\"${section}Step${stepNum}\">./launch</code>
<button class=\"copy-btn\" onclick=\"copyToClipboard('${section}Step${stepNum}')\">Copy</button>
</div>`
            };
        }

        // Update workspace title as user types date/title
        function updateWorkspaceTitle() {
            const testTitle = document.getElementById('testTitle').value || '[testTitle]';
            const testDate = document.getElementById('testDate').value || '[date]';
            const workspaceTitle = `${testDate}-${testTitle}`;
            document.getElementById('workspaceTitle').value = workspaceTitle;
        }

        // Ensure the generate button is bound to generateSteps

        function generateSteps() {
            try {
                // Clear previous steps
                document.getElementById('stowSteps').innerHTML = '';
                document.getElementById('bufferSteps').innerHTML = '';
                document.getElementById('transferSteps').innerHTML = '';
                // Get general values from inputs
                const testTitle = document.getElementById('testTitle').value || '[testTitle]';
                const testDate = document.getElementById('testDate').value || '[date]';
                const workspace = document.getElementById('workspaceTitle').value || `${testDate}-${testTitle}`;
                // get mainline value
                const mainlineValues = toggleMainline();
                const stowMainlineValue = mainlineValues.stow;
                const bufferMainlineValue = mainlineValues.buffer;
                const transferMainlineValue = mainlineValues.transfer;
                //get event ID
                const eventIdValue = document.getElementById('stowEventId').value;
                const eventId = eventIdValue ? `--eventId ${eventIdValue}` : '';
                const bufferEventIdValue = document.getElementById('bufferEventId').value;
                const bufferEventId = bufferEventIdValue ? `--eventId ${bufferEventIdValue}` : '';
                const transferEventIdValue = document.getElementById('transferEventId').value;
                const transferEventId = transferEventIdValue ? `--eventId ${transferEventIdValue}` : '';
                //get workcell ID
                const stowWorkcellId = document.getElementById('stowWorkcellId').value || '[workcellId]'; 
                const bufferWorkcellId = document.getElementById('bufferWorkcellId').value || '[workcellId]'; 
                const transferWorkcellId = document.getElementById('transferWorkcellId').value || '[workcellId]';

                // Reset tab visibility
                document.getElementById('stowTabBtn').style.display = 'none';
                document.getElementById('transferTabBtn').style.display = 'none';
                document.getElementById('bufferTabBtn').style.display = 'none';

                let anySection = false;

                // Defensive: ensure global vsconfig variables exist
                if (typeof window.stowVsconfig === 'undefined') window.stowVsconfig = '';
                if (typeof window.bufferVsconfig === 'undefined') window.bufferVsconfig = '';
                if (typeof window.transferVsconfig === 'undefined') window.transferVsconfig = '';

                // Generate steps for Stow Section
                if (document.getElementById('stowCheckbox').checked) {
                    anySection = true;
                    const sectionID = 'stow';
                    document.getElementById(`${sectionID}TabBtn`).style.display = 'inline-block';
                    toggleVulcanStowConfig(sectionID, `${sectionID}VsConfigPickInput`, `${sectionID}Vsconfig`);
                    const { packageNames, gitCommands } = getDynamicInputs(`${sectionID}DynamicInputs`);
                    const imageTag = getImageTagInput(sectionID, `${sectionID}ImageTagInput`);
                    const imageTagChecked = document.getElementById(`${sectionID}ImageTag`).checked;
                    const deployArtifacts = getDeployArtifactsInput(sectionID, `${sectionID}DeployArtifactsPickInput`);
                    let steps = [];
                    let stepNum = 1;
                    steps.push(step1(sectionID, stepNum++, workspace, eventId, stowMainlineValue).html);
                    if (packageNames.length > 0) {
                        steps.push(step2(sectionID, stepNum++, packageNames).html);
                    }
                    steps.push(step3(sectionID, stepNum++, window.stowVsconfig).html);
                    steps.push(step4(sectionID, stepNum++, packageNames, gitCommands, stowWorkcellId).html);
                    steps.push(step5(sectionID, stepNum++, deployArtifacts).html);
                    if (imageTagChecked) {
                        steps.push(step6(sectionID, stepNum++, imageTag).html);
                    }
                    steps.push(step7(sectionID, stepNum++).html);
                    steps.push(step8(sectionID, stepNum++, workspace).html);
                    steps.push(step9(sectionID, stepNum++, workspace).html);
                    steps.push(step10(sectionID, stepNum++).html);
                    document.getElementById('stowSteps').innerHTML = steps.join('');
                }
                // Generate steps for Buffer Section
                if (document.getElementById('bufferCheckbox').checked) {
                    anySection = true;
                    const sectionID = 'buffer';
                    document.getElementById(`${sectionID}TabBtn`).style.display = 'inline-block';
                    toggleVulcanStowConfig(sectionID, `${sectionID}VsConfigPickInput`, `${sectionID}Vsconfig`);
                    const { packageNames, gitCommands } = getDynamicInputs(`${sectionID}DynamicInputs`);
                    const imageTag = getImageTagInput(sectionID, `${sectionID}ImageTagInput`);
                    const imageTagChecked = document.getElementById(`${sectionID}ImageTag`).checked;
                    const deployArtifacts = getDeployArtifactsInput(sectionID, `${sectionID}DeployArtifactsPickInput`);
                    let steps = [];
                    let stepNum = 1;
                    steps.push(step1(sectionID, stepNum++, workspace, bufferEventId, bufferMainlineValue).html);
                    if (packageNames.length > 0) {
                        steps.push(step2(sectionID, stepNum++, packageNames).html);
                    }
                    steps.push(step3(sectionID, stepNum++, window.bufferVsconfig).html);
                    steps.push(step4(sectionID, stepNum++, packageNames, gitCommands, bufferWorkcellId).html);
                    steps.push(step5(sectionID, stepNum++, deployArtifacts).html);
                    if (imageTagChecked) {
                        steps.push(step6(sectionID, stepNum++, imageTag).html);
                    }
                    steps.push(step7(sectionID, stepNum++).html);
                    steps.push(step8(sectionID, stepNum++, workspace).html);
                    steps.push(step9(sectionID, stepNum++, workspace).html);
                    steps.push(step10(sectionID, stepNum++).html);
                    document.getElementById('bufferSteps').innerHTML = steps.join('');
                }
                // Generate steps for Transfer Section
                if (document.getElementById('transferCheckbox').checked) {
                    anySection = true;
                    const sectionID = 'transfer';
                    document.getElementById(`${sectionID}TabBtn`).style.display = 'inline-block';
                    toggleVulcanStowConfig(sectionID, `${sectionID}VsConfigPickInput`, `${sectionID}Vsconfig`);
                    const { packageNames, gitCommands } = getDynamicInputs(`${sectionID}DynamicInputs`);
                    const imageTag = getImageTagInput(sectionID, `${sectionID}ImageTagInput`);
                    const imageTagChecked = document.getElementById(`${sectionID}ImageTag`).checked;
                    const deployArtifacts = getDeployArtifactsInput(sectionID, `${sectionID}DeployArtifactsPickInput`);
                    let steps = [];
                    let stepNum = 1;
                    steps.push(step1(sectionID, stepNum++, workspace, transferEventId, transferMainlineValue).html);
                    if (packageNames.length > 0) {
                        steps.push(step2(sectionID, stepNum++, packageNames).html);
                    }
                    steps.push(step3(sectionID, stepNum++, window.transferVsconfig).html);
                    steps.push(step4(sectionID, stepNum++, packageNames, gitCommands, transferWorkcellId).html);
                    steps.push(step5(sectionID, stepNum++, deployArtifacts).html);
                    if (imageTagChecked) {
                        steps.push(step6(sectionID, stepNum++, imageTag).html);
                    }
                    steps.push(step7(sectionID, stepNum++).html);
                    steps.push(step8(sectionID, stepNum++, workspace).html);
                    steps.push(step9(sectionID, stepNum++, workspace).html);
                    steps.push(step10(sectionID, stepNum++).html);
                    document.getElementById('transferSteps').innerHTML = steps.join('');
                }
                // Show the steps guide and update button visibility
                document.getElementById('stepsGuide').style.display = anySection ? 'block' : 'none';
                document.getElementById('generateBtn').style.display = anySection ? 'none' : 'inline-block';
                document.getElementById('regenerateBtn').style.display = anySection ? 'inline-block' : 'none';
                document.getElementById('downloadBtn').style.display = anySection ? 'inline-block' : 'none';
                // Automatically open the first visible tab
                const firstVisibleTab = document.querySelector('.tab button[style*="inline-block"]');
                if (firstVisibleTab) {
                    firstVisibleTab.click();
                }
                if (!anySection) {
                    alert('Please select at least one section (Stow, Buffer, or Transfer) to generate steps.');
                }
            } catch (e) {
                console.error('Error generating steps:', e);
                alert('An error occurred while generating steps. Please check your input and try again.\n' + e);
            }
        }

        function openTab(evt, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tabcontent');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].style.display = 'none';
            }

            // Remove active class from all tab links
            const tabLinks = document.getElementsByClassName('tablinks');
            for (let i = 0; i < tabLinks.length; i++) {
                tabLinks[i].className = tabLinks[i].className.replace(' active', '');
            }

            // Show the current tab and add active class
            document.getElementById(tabName).style.display = 'block';
            evt.currentTarget.className += ' active';
        }

        function resetForm() {
            // Hide steps and show form
            document.getElementById('stepsGuide').style.display = 'none';
            document.getElementById('generateBtn').style.display = 'inline-block';
            document.getElementById('regenerateBtn').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';
            // Reset all form fields
            document.getElementById('testTitle').value = '';
            document.getElementById('testDate').value = '';
            document.getElementById('workspaceTitle').value = '';

            // Reset all sections
            ['stow', 'buffer', 'transfer'].forEach(section => {
                // Reset checkboxes
                document.getElementById(`${section}Checkbox`).checked = false;
                document.getElementById(`${section}Section`).style.display = 'none';
                document.getElementById(`${section}Mainline`).checked = false;
                document.getElementById(`${section}VsConfigPick`).checked = false;
                document.getElementById(`${section}ImageTag`).checked = false;
                document.getElementById(`${section}CherryPick`).checked = false;
                document.getElementById(`${section}DeployArtifactsPick`).checked = false;

                // Reset input values
                document.getElementById(`${section}EventId`).value = '';
                document.getElementById(`${section}WorkcellId`).value = '';
                document.getElementById(`${section}VsConfigPickValue`).value = '';
                document.getElementById(`${section}ImageTagValue`).value = '';
                document.getElementById(`${section}DeployArtifactsPickValue`).value = '';

                // Reset input boxes display
                document.getElementById(`${section}VsConfigPickInput`).style.display = 'none';
                document.getElementById(`${section}ImageTagInput`).style.display = 'none';
                document.getElementById(`${section}DeployArtifactsPickInput`).style.display = 'none';
                document.getElementById(`${section}CherryPickSection`).style.display = 'none';
                document.getElementById(`${section}AddBtn`).style.display = 'none';

                // Clear dynamic inputs
                const dynamicInputsContainer = document.getElementById(`${section}DynamicInputs`);
                while (dynamicInputsContainer.firstChild) {
                    dynamicInputsContainer.removeChild(dynamicInputsContainer.firstChild);
                }

                // Clear steps content
                document.getElementById(`${section}Steps`).innerHTML = '';
                document.getElementById(`${section}TabBtn`).style.display = 'none';
            });

            // Clear any global variables used for configs
            window.stowVsconfig = '';
            window.bufferVsconfig = '';
            window.transferVsconfig = '';
        }

        // Show/hide cherry-pick section and add button
        function toggleCherryPickSection(sectionId, buttonId) {
            const section = document.getElementById(sectionId);
            const button = document.getElementById(buttonId);
            const isVisible = section.style.display === 'block';
            section.style.display = isVisible ? 'none' : 'block';
            button.style.display = isVisible ? 'none' : 'inline-block';
        }

        // Add dynamic cherry-pick input fields
        function addDynamicInputs(sectionId) {
            const section = document.getElementById(sectionId);
            const inputGroup = document.createElement('div');
            inputGroup.className = 'form-group dynamic-input-group';
            inputGroup.innerHTML = `
                <label>Enter Package Name:</label>
                <input type="text" placeholder="Beware case sensitive">
                <label>Cherry Pick Command:</label>
                <textarea placeholder="Paste Cherry Pick here"></textarea>
                <button class="delete-btn" onclick="deleteDynamicInput(this)" style="background-color: #f44336; color: white; border: none; border-radius: 4px; padding: 3px 8px; font-size: 12px; cursor: pointer;">Delete</button>
            `;
            section.appendChild(inputGroup);
        }

        // Ensure each "Add" button is only bound to its respective section once
        document.getElementById('stowAddBtn').onclick = () => addDynamicInputs('stowDynamicInputs');
        document.getElementById('bufferAddBtn').onclick = () => addDynamicInputs('bufferDynamicInputs');
        document.getElementById('transferAddBtn').onclick = () => addDynamicInputs('transferDynamicInputs');

        function deleteDynamicInput(button) {
            const inputGroup = button.parentElement;
            inputGroup.remove();
        }

        // Show/hide add button for cherry-pick
        function toggleAddButton(checkboxId, buttonId) {
            const checkbox = document.getElementById(checkboxId);
            const button = document.getElementById(buttonId);
            button.style.display = checkbox.checked ? 'inline-block' : 'none';
        }

        // Bind add button toggles for cherry-pick checkboxes
        document.getElementById('stowCherryPick').addEventListener('change', () => toggleAddButton('stowCherryPick', 'stowAddBtn'));
        document.getElementById('bufferCherryPick').addEventListener('change', () => toggleAddButton('bufferCherryPick', 'bufferAddBtn'));
        document.getElementById('transferCherryPick').addEventListener('change', () => toggleAddButton('transferCherryPick', 'transferAddBtn'));

        // Ensure add buttons are hidden on page load

        document.getElementById('stowCherryPick').addEventListener('change', () => toggleAddButton('stowCherryPick', 'stowAddBtn'));
        document.getElementById('bufferCherryPick').addEventListener('change', () => toggleAddButton('bufferCherryPick', 'bufferAddBtn'));
        document.getElementById('transferCherryPick').addEventListener('change', () => toggleAddButton('transferCherryPick', 'transferAddBtn'));

        // Ensure add buttons are hidden on page load
        document.getElementById('stowAddBtn').style.display = 'none';
        document.getElementById('bufferAddBtn').style.display = 'none';
        document.getElementById('transferAddBtn').style.display = 'none';

        // Collect dynamic cherry-pick input values
        function getDynamicInputs(sectionId) {
            const packageNames = [];
            const gitCommands = [];
            const inputGroups = document.querySelectorAll(`#${sectionId} .dynamic-input-group`);
            
            inputGroups.forEach(group => {
                const packageName = group.querySelector('input[type="text"]').value.trim();
                const gitCommand = group.querySelector('textarea').value.trim();
                if (packageName && gitCommand) {
                    packageNames.push(packageName);
                    gitCommands.push(gitCommand);
                }
            });
            return { packageNames, gitCommands };
        }

        // Store VulcanStowConfig cherry-pick value in global variable
        function toggleVulcanStowConfig(sectionId, inputBoxId, variableName) {
            const checkbox = document.getElementById(`${sectionId}VsConfigPick`);
            const inputBox = document.getElementById(inputBoxId);
            let vsconfig = '';

            if (checkbox.checked) {
                inputBox.style.display = 'block';
                vsconfig = document.getElementById(`${sectionId}VsConfigPickValue`).value.trim();
            } else {
                inputBox.style.display = 'none';
                vsconfig = '';
            }

            window[variableName] = vsconfig; // Store the value in a global variable dynamically
        }

        // Get image tag input value for a section
        function getImageTagInput(sectionId, inputBoxId) {
            const checkbox = document.getElementById(`${sectionId}ImageTag`);
            const inputBox = document.getElementById(inputBoxId);
            let imageTag = '';

            if (checkbox.checked) {
                imageTag = document.getElementById(`${sectionId}ImageTagValue`).value.trim();
            }

            return imageTag;
        }

        // Get deploy artifacts input value for a section
        function getDeployArtifactsInput(sectionId, inputBoxId) {
            const checkbox = document.getElementById(`${sectionId}DeployArtifactsPick`);
            const inputBox = document.getElementById(inputBoxId);
            let deployArtifacts = '';

            if (checkbox.checked) {
                deployArtifacts = document.getElementById(`${sectionId}DeployArtifactsPickValue`).value.trim();
            }

            return deployArtifacts;
        }

        // Show/hide troubleshooting panel
        function toggleTroubleshoot() {
            const panel = document.getElementById('troubleshootPanel');
            const currentVersion = document.getElementById('version');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'block';
                currentVersion.style.display = 'none';
                
            } else {
                panel.style.display = 'none';
                currentVersion.style.display = 'block';
            }
        }

        // Regenerate steps (reset tabs, rerun generateSteps)
        function regenerate() {
            const stowTabBtn = document.getElementById('stowTabBtn');
            const bufferTabBtn = document.getElementById('bufferTabBtn');
            const transferTabBtn = document.getElementById('transferTabBtn');
            
            stowTabBtn.style.display = 'none';
            bufferTabBtn.style.display = 'none';
            transferTabBtn.style.display = 'none';
            
            generateSteps();
        }

        // Download configuration function
        function downloadConfig() {
            // Prepare config object to store generated steps for each section
            const config = {};

            // Helper to get the generated steps for a section as {stepN: [lines]}
            function getSectionSteps(section) {
                const stepsDiv = document.getElementById(`${section}Steps`);
                if (!stepsDiv) return {};
                const codeBlocks = stepsDiv.querySelectorAll('code');
                const steps = {};
                codeBlocks.forEach((code, idx) => {
                    const lines = code.textContent.trim().split('\n').map(line => line.trim()).filter(line => line.length > 0);
                    steps[`step${idx + 1}`] = lines;
                });
                return steps;
            }

            if (document.getElementById('stowCheckbox').checked) {
                config.stow = getSectionSteps('stow');
            }
            if (document.getElementById('bufferCheckbox').checked) {
                config.buffer = getSectionSteps('buffer');
            }
            if (document.getElementById('transferCheckbox').checked) {
                config.transfer = getSectionSteps('transfer');
            }

            // Convert to JSON string with pretty formatting
            const configJson = JSON.stringify(config, null, 2);

            // Create blob and download
            const blob = new Blob([configJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `config.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Show/hide section (stow, buffer, transfer) based on checkbox
        function toggleSection(sectionId) {
            const checkbox = document.getElementById(sectionId.replace('Section', 'Checkbox'));
            const section = document.getElementById(sectionId);
            if (checkbox && section) {
                section.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // Bind checkbox change events to toggleSection for each section
        document.getElementById('stowCheckbox').addEventListener('change', function() {
            toggleSection('stowSection');
        });
        document.getElementById('bufferCheckbox').addEventListener('change', function() {
            toggleSection('bufferSection');
        });
        document.getElementById('transferCheckbox').addEventListener('change', function() {
            toggleSection('transferSection');
        });
        
        // Show/hide input boxes for cherry-pick, image tag, etc.
        function toggleInput(inputId) {
            const inputBox = document.getElementById(inputId);
            const checkboxId = inputId.replace('Input', '');
            const checkbox = document.getElementById(checkboxId);
            if (checkbox && inputBox) {
                inputBox.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // Bind checkbox change events for image tag, Vulcan Stow Config, and Deployment Artifacts
        ['stow', 'buffer', 'transfer'].forEach(section => {
            document.getElementById(`${section}ImageTag`).addEventListener('change', function() {
                toggleInput(`${section}ImageTagInput`);
            });
            document.getElementById(`${section}VsConfigPick`).addEventListener('change', function() {
                toggleInput(`${section}VsConfigPickInput`);
            });
            document.getElementById(`${section}DeployArtifactsPick`).addEventListener('change', function() {
                toggleInput(`${section}DeployArtifactsPickInput`);
            });
        });

        // Mainline toggle: returns mainline/branch flags for each section
        function toggleMainline() {
            const stowMainlineCheckbox = document.getElementById('stowMainline');
            const bufferMainlineCheckbox = document.getElementById('bufferMainline');
            const transferMainlineCheckbox = document.getElementById('transferMainline');
            const mainlineValues = {
                stow: stowMainlineCheckbox && stowMainlineCheckbox.checked ? '--branch mainline' : '--latest',
                buffer: bufferMainlineCheckbox && bufferMainlineCheckbox.checked ? '--branch mainline' : '--latest',
                transfer: transferMainlineCheckbox && transferMainlineCheckbox.checked ? '--branch mainline' : '--latest'
            };
            return mainlineValues;
        }

        // Copy to clipboard function for code blocks
        function copyToClipboard(elementId) {
            const codeElem = document.getElementById(elementId);
            if (!codeElem) return;
            let text = codeElem.innerText || codeElem.textContent;
            text = text.replace(/<br\s*\/?>/gi, '\n');
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                navigator.clipboard && navigator.clipboard.writeText(text);
            }
            document.body.removeChild(textarea);

            // Change button text to "Copied!" then revert
            const codeBlock = codeElem.parentElement;
            if (codeBlock) {
                const btn = codeBlock.querySelector('.copy-btn');
                if (btn) {
                    const original = btn.textContent;
                    btn.textContent = 'Copied!';
                    btn.disabled = true;
                    setTimeout(() => {
                        btn.textContent = original;
                        btn.disabled = false;
                    }, 1500);
                }
            }
        }

        // --- Session Table Logic ---

        // Utility: get all sessions from localStorage
        function getSessions() {
            const sessions = localStorage.getItem('ws_sessions');
            return sessions ? JSON.parse(sessions) : [];
        }

        // Utility: save all sessions to localStorage
        function setSessions(sessions) {
            localStorage.setItem('ws_sessions', JSON.stringify(sessions));
        }

        // Save current session
        function saveSession() {
            // Gather form data
            const testTitle = document.getElementById('testTitle').value || '[Title]';
            const testDate = document.getElementById('testDate').value || '[date]';
            const workspaceTitle = document.getElementById('workspaceTitle').value || '';
            const timestamp = new Date().toLocaleString();
            // Save all form fields and generated steps
            const formData = {
                testTitle,
                testDate,
                workspaceTitle,
                stow: getSectionFormData('stow'),
                buffer: getSectionFormData('buffer'),
                transfer: getSectionFormData('transfer'),
                steps: {
                    stow: document.getElementById('stowSteps').innerHTML,
                    buffer: document.getElementById('bufferSteps').innerHTML,
                    transfer: document.getElementById('transferSteps').innerHTML
                }
            };
            // Use a unique id for session
            const sessionId = `${workspaceTitle}_${Date.now()}`;
            const sessions = getSessions();
            sessions.unshift({
                id: sessionId,
                name: testTitle,
                timestamp,
                data: formData
            });
            setSessions(sessions);
            renderSessionTable();
        }

        // Get all form values for a section
        function getSectionFormData(section) {
            return {
                checked: document.getElementById(`${section}Checkbox`).checked,
                workcellId: document.getElementById(`${section}WorkcellId`).value,
                eventId: document.getElementById(`${section}EventId`).value,
                mainline: document.getElementById(`${section}Mainline`).checked,
                imageTag: document.getElementById(`${section}ImageTag`).checked,
                imageTagValue: document.getElementById(`${section}ImageTagValue`).value,
                cherryPick: document.getElementById(`${section}CherryPick`).checked,
                vsConfigPick: document.getElementById(`${section}VsConfigPick`).checked,
                vsConfigPickValue: document.getElementById(`${section}VsConfigPickValue`).value,
                deployArtifactsPick: document.getElementById(`${section}DeployArtifactsPick`).checked,
                deployArtifactsPickValue: document.getElementById(`${section}DeployArtifactsPickValue`).value,
                // Dynamic cherry-pick packages
                dynamicInputs: (() => {
                    const arr = [];
                    const inputGroups = document.querySelectorAll(`#${section}DynamicInputs .dynamic-input-group`);
                    inputGroups.forEach(group => {
                        arr.push({
                            packageName: group.querySelector('input[type="text"]').value,
                            gitCommand: group.querySelector('textarea').value
                        });
                    });
                    return arr;
                })()
            };
        }

        // Render session table
        function renderSessionTable() {
            const sessions = getSessions();
            const tbody = document.getElementById('sessionTableBody');
            tbody.innerHTML = '';
            sessions.forEach(session => {
                const tr = document.createElement('tr');
                // Session name as clickable link
                const tdName = document.createElement('td');
                const link = document.createElement('button');
                link.className = 'session-link';
                link.textContent = session.name;
                link.title = 'Open this session';
                link.onclick = () => loadSession(session.id);
                tdName.appendChild(link);
                // Timestamp
                const tdTime = document.createElement('td');
                tdTime.textContent = session.timestamp;
                // Delete button
                const tdDel = document.createElement('td');
                const delBtn = document.createElement('button');
                delBtn.className = 'session-delete-btn';
                delBtn.textContent = 'Delete';
                delBtn.onclick = () => deleteSession(session.id);
                tdDel.appendChild(delBtn);

                tr.appendChild(tdName);
                tr.appendChild(tdTime);
                tr.appendChild(tdDel);
                tbody.appendChild(tr);
            });
        }

        // Load session by id
        function loadSession(sessionId) {
            const sessions = getSessions();
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            const d = session.data;
            // Restore general fields
            document.getElementById('testTitle').value = d.testTitle;
            document.getElementById('testDate').value = d.testDate;
            document.getElementById('workspaceTitle').value = d.workspaceTitle;
            // Restore each section
            ['stow', 'buffer', 'transfer'].forEach(section => {
                const s = d[section];
                document.getElementById(`${section}Checkbox`).checked = !!s.checked;
                toggleSection(`${section}Section`);
                document.getElementById(`${section}WorkcellId`).value = s.workcellId || '';
                document.getElementById(`${section}EventId`).value = s.eventId || '';
                document.getElementById(`${section}Mainline`).checked = !!s.mainline;
                document.getElementById(`${section}ImageTag`).checked = !!s.imageTag;
                document.getElementById(`${section}ImageTagValue`).value = s.imageTagValue || '';
                document.getElementById(`${section}CherryPick`).checked = !!s.cherryPick;
                document.getElementById(`${section}VsConfigPick`).checked = !!s.vsConfigPick;
                document.getElementById(`${section}VsConfigPickValue`).value = s.vsConfigPickValue || '';
                document.getElementById(`${section}DeployArtifactsPick`).checked = !!s.deployArtifactsPick;
                document.getElementById(`${section}DeployArtifactsPickValue`).value = s.deployArtifactsPickValue || '';
                // Show/hide input boxes
                toggleInput(`${section}ImageTagInput`);
                toggleInput(`${section}VsConfigPickInput`);
                toggleInput(`${section}DeployArtifactsPickInput`);
                // Cherry-pick section
                if (document.getElementById(`${section}CherryPick`).checked) {
                    document.getElementById(`${section}CherryPickSection`).style.display = 'block';
                    document.getElementById(`${section}AddBtn`).style.display = 'inline-block';
                } else {
                    document.getElementById(`${section}CherryPickSection`).style.display = 'none';
                    document.getElementById(`${section}AddBtn`).style.display = 'none';
                }
                // Clear dynamic inputs
                const dyn = document.getElementById(`${section}DynamicInputs`);
                dyn.innerHTML = '';
                // Restore dynamic cherry-pick packages
                if (s.dynamicInputs && s.dynamicInputs.length) {
                    s.dynamicInputs.forEach(input => {
                        const inputGroup = document.createElement('div');
                        inputGroup.className = 'form-group dynamic-input-group';
                        inputGroup.innerHTML = `
                            <label>Enter Package Name:</label>
                            <input type="text" placeholder="Beware case sensitive" value="${input.packageName || ''}">
                            <label>Cherry Pick Command:</label>
                            <textarea placeholder="Paste Cherry Pick here">${input.gitCommand || ''}</textarea>
                            <button class="delete-btn" onclick="deleteDynamicInput(this)" style="background-color: #f44336; color: white; border: none; border-radius: 4px; padding: 3px 8px; font-size: 12px; cursor: pointer;">Delete</button>
                        `;
                        dyn.appendChild(inputGroup);
                    });
                }
            });
            // Restore generated steps
            document.getElementById('stowSteps').innerHTML = d.steps.stow || '';
            document.getElementById('bufferSteps').innerHTML = d.steps.buffer || '';
            document.getElementById('transferSteps').innerHTML = d.steps.transfer || '';
            // Show steps guide if any section is checked
            const anySection = ['stow', 'buffer', 'transfer'].some(section => d[section].checked);
            document.getElementById('stepsGuide').style.display = anySection ? 'block' : 'none';
            document.getElementById('generateBtn').style.display = anySection ? 'none' : 'inline-block';
            document.getElementById('regenerateBtn').style.display = anySection ? 'inline-block' : 'none';
            document.getElementById('downloadBtn').style.display = anySection ? 'inline-block' : 'none';
            // Open the first visible tab
           
            setTimeout(() => {
                const firstVisibleTab = document.querySelector('.tab button[style*="inline-block"]');
                if (firstVisibleTab) firstVisibleTab.click();
            }, 100);
        }

        // Delete session by id
        function deleteSession(sessionId) {
            let sessions = getSessions();
            sessions = sessions.filter(s => s.id !== sessionId);
            setSessions(sessions);
            renderSessionTable();
        }

        // Render session table on page load
        document.addEventListener('DOMContentLoaded', renderSessionTable);
    </script>
</body>
</html>
